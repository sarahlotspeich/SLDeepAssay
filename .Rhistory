library(kableExtra)
library(dplyr)
library(tidyr)
# load data
setwd(here::here())
md_sim_data = read.csv("https://raw.githubusercontent.com/sarahlotspeich/SLDeepAssay/main/sims/sim_data/md_sim_data.csv")
# format numbers (default to 2 decimal places)
format_nums = function(x, digits = 2) {
paste0("$", format(round(x, digits = digits), nsmall = digits) , "$")
}
# check number of sims removed
md_sim_data |>
select(Message) |>
sum()
# summarize sim results
md_sim_summ = md_sim_data |>
mutate(M = factor(M, levels = c("6, 12, 18", "9, 18, 27", "12, 24, 36"))) |>
group_by(constant_Tau, M, n, assay_type, bc) |>
summarise(n_removed = sum(Message),
rel_bias = mean(Est - Tau),
ase = mean(SE),
ese = sd(Est),
cp = mean(LB <= Tau & Tau <= UB)) |>
pivot_wider(id_cols = c("M", "n", "constant_Tau"),
names_from = c("bc", "assay_type"),
values_from = c("n_removed", "rel_bias", "ase", "ese", "cp"))
analysis_cols = as.vector(outer(c("rel_bias", "ase", "ese", "cp"),
as.vector(outer(c("_MLE", "_BCMLE"), c("_woUDSA", "_wUDSA"), paste0)), paste0))
col_order = c("n", "M", analysis_cols)
# produce table with simulation summary
md_sim_summ |>
filter(constant_Tau == 1) |> # Subset to columns with constant Tau
dplyr::ungroup() |>
dplyr::select(all_of(col_order)) |>
dplyr::mutate_at(analysis_cols, format_nums) |>
magrittr::set_colnames(c("$\\pmb{n'}$", "M", rep(c("Bias", "ASE", "ESE", "CP"), times = 4))) |>
kable(format = "latex", digits = 3, align = c(rep("c", 4), rep("r", 16)),
booktabs = TRUE, linesep = c("", "", "\\addlinespace"), escape = FALSE) |>
add_header_above(header = c(" " = 2, "MLE" = 4, "Bias-Corrected MLE" = 4, "MLE" = 4, "Bias-Corrected MLE" = 4), bold = TRUE) |>
add_header_above(header = c(" " = 2, "Without UDSA" = 8, "With UDSA" = 8), bold = TRUE) |>
row_spec(row = 0, bold = TRUE)
# summarize sim results
md_sim_summ = md_sim_data |>
mutate(M = factor(M, levels = c("6, 12, 18", "9, 18, 27", "12, 24, 36"))) |>
group_by(constant_Tau, n, M, assay_type, bc) |>
summarise(n_removed = sum(Message),
rel_bias = mean(Est - Tau),
ase = mean(SE),
ese = sd(Est),
cp = mean(LB <= Tau & Tau <= UB)) |>
pivot_wider(id_cols = c("M", "n", "constant_Tau"),
names_from = c("bc", "assay_type"),
values_from = c("n_removed", "rel_bias", "ase", "ese", "cp"))
analysis_cols = as.vector(outer(c("rel_bias", "ase", "ese", "cp"),
as.vector(outer(c("_MLE", "_BCMLE"), c("_woUDSA", "_wUDSA"), paste0)), paste0))
col_order = c("n", "M", analysis_cols)
# produce table with simulation summary
md_sim_summ |>
filter(constant_Tau == 1) |> # Subset to columns with constant Tau
dplyr::ungroup() |>
dplyr::select(all_of(col_order)) |>
dplyr::mutate_at(analysis_cols, format_nums) |>
magrittr::set_colnames(c("$\\pmb{n'}$", "M", rep(c("Bias", "ASE", "ESE", "CP"), times = 4))) |>
kable(format = "latex", digits = 3, align = c(rep("c", 4), rep("r", 16)),
booktabs = TRUE, linesep = c("", "", "\\addlinespace"), escape = FALSE) |>
add_header_above(header = c(" " = 2, "MLE" = 4, "Bias-Corrected MLE" = 4, "MLE" = 4, "Bias-Corrected MLE" = 4), bold = TRUE) |>
add_header_above(header = c(" " = 2, "Without UDSA" = 8, "With UDSA" = 8), bold = TRUE) |>
row_spec(row = 0, bold = TRUE)
## Title: IUPM Real Data Plot (Figure 2)
## Author:  Brian Richardson
## Date:  01/04/2023
## Purpose: Plot real data results for SLDeepAssay paper
## Prepare workspace
rm(list=ls())
setwd(here::here())
## load packages
library(ggplot2)
library(dplyr)
library(tidyr)
# Load data
figure2_data = read.csv("https://raw.githubusercontent.com/sarahlotspeich/SLDeepAssay/main/real_data_application/figure2_data.csv")
## create Figure 2
figure2_data |>
mutate(bias.correction = factor(bias.correction,
levels = c("MLE", "BC-MLE")),
method = factor(method,
levels = c("Without UDSA (Multiple Dilutions)",
"With UDSA (Multiple Dilutions)",
"With UDSA (Single Dilution)")),
id.lab = factor(paste0("Subject ", id),
levels = paste0("Subject C", 1:17)),
method.bc = factor(paste0(method, "_", bias.correction)),
method.bc = factor(method.bc, levels = rev(levels(method.bc)))) |>
ggplot(aes(x = bias.correction, y = mle, ymin = ci.lower, ymax = ci.upper,
color = method, shape = bias.correction)) +
geom_point(size = 2,
position = position_dodge(width = 0.5)) +
geom_errorbar(width = 0.3,
position = position_dodge(width = 0.5)) +
theme_light() +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
strip.text = element_text(color = "black"),
strip.background = element_rect(fill = "white", colour = "black"),
legend.position = c(0.95, 0.07),
legend.justification = c("right", "bottom"),
legend.box = "horizontal",
legend.key.width = unit(1.5, "cm")) +
ylab("IUPM of HIV") +#ylab("IUPM MLE and 95% CI") +
labs(color = "Method",
shape = "Bias Correction") +
ggthemes::scale_colour_colorblind() + #scale_color_grey() +
#scale_y_continuous(trans = "log10") +
facet_wrap(~ id.lab, ncol = 5, scales = "free") -> real_data_plot
## Title: IUPM Real Data Plot (Figure 2)
## Author:  Brian Richardson
## Date:  01/04/2023
## Purpose: Plot real data results for SLDeepAssay paper
## Prepare workspace
rm(list=ls())
setwd(here::here())
## load packages
library(ggplot2)
library(dplyr)
library(tidyr)
# Load data
figure2_data = read.csv("https://raw.githubusercontent.com/sarahlotspeich/SLDeepAssay/main/real_data_application/figure2_data.csv")
## create Figure 2
figure2_data |>
mutate(bias.correction = factor(bias.correction,
levels = c("MLE", "BC-MLE")),
method = factor(method,
levels = c("Without UDSA (Multiple Dilutions)",
"With UDSA (Multiple Dilutions)",
"With UDSA (Single Dilution)")),
id.lab = factor(paste0("Subject ", id),
levels = paste0("Subject C", 1:17)),
method.bc = factor(paste0(method, "_", bias.correction)),
method.bc = factor(method.bc, levels = rev(levels(method.bc)))) |>
ggplot(aes(x = bias.correction, y = mle, ymin = ci.lower, ymax = ci.upper,
color = method, shape = bias.correction)) +
geom_point(size = 2,
position = position_dodge(width = 0.5)) +
geom_errorbar(width = 0.3,
position = position_dodge(width = 0.5)) +
theme_light() +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
strip.text = element_text(color = "black"),
strip.background = element_rect(fill = "white", colour = "black"),
legend.position = c(0.95, 0.07),
legend.justification = c("right", "bottom"),
legend.box = "horizontal",
legend.key.width = unit(1.5, "cm")) +
ylab("IUPM of HIV") +#ylab("IUPM MLE and 95% CI") +
labs(color = "Method",
shape = "Bias Correction") +
ggthemes::scale_colour_colorblind() + #scale_color_grey() +
#scale_y_continuous(trans = "log10") +
facet_wrap(~ id.lab, ncol = 5, scales = "free") -> real_data_plot
real_data_plot +
ggtitle("IUPM MLEs and 95% Confidence Intervals by Method",
subtitle="MLEs and Bias-Corrected MLEs")
ggsave(real_data_plot, filename = "figures/real_data_plot.png", width = 10, height = 10)
## create Figure 2
figure2_data |>
mutate(bias.correction = factor(bias.correction,
levels = c("MLE", "BC-MLE")),
method = factor(method,
levels = c("Without UDSA (Multiple Dilutions)",
"With UDSA (Multiple Dilutions)",
"With UDSA (Single Dilution)")),
id.lab = factor(paste0("Subject ", id),
levels = paste0("Subject C", 1:17)),
method.bc = factor(paste0(method, "_", bias.correction)),
method.bc = factor(method.bc, levels = rev(levels(method.bc)))) |>
ggplot(aes(x = bias.correction, y = mle, ymin = ci.lower, ymax = ci.upper,
color = method, shape = bias.correction)) +
geom_point(size = 2,
position = position_dodge(width = 0.5)) +
geom_errorbar(width = 0.3,
position = position_dodge(width = 0.5)) +
scale_y_continuous(trans = "log") +
theme_light() +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
strip.text = element_text(color = "black"),
strip.background = element_rect(fill = "white", colour = "black"),
legend.position = c(0.95, 0.07),
legend.justification = c("right", "bottom"),
legend.box = "horizontal",
legend.key.width = unit(1.5, "cm")) +
ylab("IUPM of HIV") +#ylab("IUPM MLE and 95% CI") +
labs(color = "Method",
shape = "Bias Correction") +
ggthemes::scale_colour_colorblind() + #scale_color_grey() +
#scale_y_continuous(trans = "log10") +
facet_wrap(~ id.lab, ncol = 5, scales = "free") -> real_data_plot
real_data_plot +
ggtitle("IUPM MLEs and 95% Confidence Intervals by Method",
subtitle="MLEs and Bias-Corrected MLEs")
## create Figure 2
figure2_data |>
mutate(bias.correction = factor(bias.correction,
levels = c("MLE", "BC-MLE")),
method = factor(method,
levels = c("Without UDSA (Multiple Dilutions)",
"With UDSA (Multiple Dilutions)",
"With UDSA (Single Dilution)")),
id.lab = factor(paste0("Subject ", id),
levels = paste0("Subject C", 1:17)),
method.bc = factor(paste0(method, "_", bias.correction)),
method.bc = factor(method.bc, levels = rev(levels(method.bc)))) |>
ggplot(aes(x = bias.correction, y = mle, ymin = ci.lower, ymax = ci.upper,
color = method, shape = bias.correction)) +
geom_point(size = 2,
position = position_dodge(width = 0.5)) +
geom_errorbar(width = 0.3,
position = position_dodge(width = 0.5)) +
theme_light() +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
strip.text = element_text(color = "black"),
strip.background = element_rect(fill = "white", colour = "black"),
legend.position = c(0.95, 0.07),
legend.justification = c("right", "bottom"),
legend.box = "horizontal",
legend.key.width = unit(1.5, "cm")) +
ylab("IUPM of HIV") +#ylab("IUPM MLE and 95% CI") +
labs(color = "Method",
shape = "Bias Correction") +
ggthemes::scale_colour_colorblind() + #scale_color_grey() +
scale_y_continuous(trans = "log10") +
facet_wrap(~ id.lab, ncol = 5, scales = "free") -> real_data_plot_log_IUPM
real_data_plot_log_IUPM +
ggtitle("IUPM MLEs and 95% Confidence Intervals by Method",
subtitle="MLEs and Bias-Corrected MLEs")
ggsave(real_data_plot, filename = "figures/real_data_plot_log_IUPM.png", width = 10, height = 10)
ggsave(real_data_plot, filename = "figures/real_data_plot_log_IUPM.png", width = 10, height = 10)
## create Figure 2
figure2_data |>
mutate(bias.correction = factor(bias.correction,
levels = c("MLE", "BC-MLE")),
method = factor(method,
levels = c("Without UDSA (Multiple Dilutions)",
"With UDSA (Multiple Dilutions)",
"With UDSA (Single Dilution)")),
id.lab = factor(paste0("Subject ", id),
levels = paste0("Subject C", 1:17)),
method.bc = factor(paste0(method, "_", bias.correction)),
method.bc = factor(method.bc, levels = rev(levels(method.bc)))) |>
ggplot(aes(x = bias.correction, y = log(mle),
ymin = log(ci.lower), ymax = log(ci.upper),
color = method, shape = bias.correction)) +
geom_point(size = 2,
position = position_dodge(width = 0.5)) +
geom_errorbar(width = 0.3,
position = position_dodge(width = 0.5)) +
theme_light() +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
strip.text = element_text(color = "black"),
strip.background = element_rect(fill = "white", colour = "black"),
legend.position = c(0.95, 0.07),
legend.justification = c("right", "bottom"),
legend.box = "horizontal",
legend.key.width = unit(1.5, "cm")) +
ylab("IUPM of HIV") +#ylab("IUPM MLE and 95% CI") +
labs(color = "Method",
shape = "Bias Correction") +
ggthemes::scale_colour_colorblind() + #scale_color_grey() +
#scale_y_continuous(trans = "log10") +
facet_wrap(~ id.lab, ncol = 5, scales = "free") -> real_data_plot_log_IUPM
real_data_plot_log_IUPM +
ggtitle("IUPM MLEs and 95% Confidence Intervals by Method",
subtitle="MLEs and Bias-Corrected MLEs")
ggsave(real_data_plot, filename = "figures/real_data_plot_log_IUPM.png", width = 10, height = 10)
## Title: IUPM Real Data Plot (Figure 2)
## Author:  Brian Richardson
## Date:  01/04/2023
## Purpose: Plot real data results for SLDeepAssay paper
## Prepare workspace
rm(list=ls())
setwd(here::here())
## load packages
library(ggplot2)
library(dplyr)
library(tidyr)
# Load data
figure2_data = read.csv("https://raw.githubusercontent.com/sarahlotspeich/SLDeepAssay/main/real_data_application/figure2_data.csv")
## create Figure 2
figure2_data |>
mutate(bias.correction = factor(bias.correction,
levels = c("MLE", "BC-MLE")),
method = factor(method,
levels = c("Without UDSA (Multiple Dilutions)",
"With UDSA (Multiple Dilutions)",
"With UDSA (Single Dilution)")),
id.lab = factor(paste0("Subject ", id),
levels = paste0("Subject C", 1:17)),
method.bc = factor(paste0(method, "_", bias.correction)),
method.bc = factor(method.bc, levels = rev(levels(method.bc)))) |>
ggplot(aes(x = bias.correction, y = log(mle),
ymin = log(ci.lower), ymax = log(ci.upper),
color = method, shape = bias.correction)) +
geom_point(size = 2,
position = position_dodge(width = 0.5)) +
geom_errorbar(width = 0.3,
position = position_dodge(width = 0.5)) +
theme_light() +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
strip.text = element_text(color = "black"),
strip.background = element_rect(fill = "white", colour = "black"),
legend.position = c(0.95, 0.07),
legend.justification = c("right", "bottom"),
legend.box = "horizontal",
legend.key.width = unit(1.5, "cm")) +
ylab("IUPM of HIV") +#ylab("IUPM MLE and 95% CI") +
labs(color = "Method",
shape = "Bias Correction") +
ggthemes::scale_colour_colorblind() + #scale_color_grey() +
#scale_y_continuous(trans = "log10") +
facet_wrap(~ id.lab, ncol = 5, scales = "free") -> real_data_plot_log_IUPM
ggsave(real_data_plot, filename = "figures/real_data_plot_log_IUPM.png", width = 10, height = 10)
ggsave(real_data_plot_log_IUPM, filename = "figures/real_data_plot_log_IUPM.png", width = 10, height = 10)
